# my_rentals - бэкенд для сайта проката автомобилей с использованием FastAPI.

### Описание проекта

Этот проект представляет собой бэкенд-часть веб-приложения для проката автомобилей. Он разработан с использованием FastAPI, современного фреймворка для создания веб-серверов и API.

### Технологии
- Python 3.11.5
- FastAPI 0.101.1
- SQLAlchemy 2.0.20
- alembic 1.11.2


### Особенности

1) Регистрация и аутентификация пользователей выполнена с помощью библотеки fastapi-users. Суперпользователь создается автоматически при первом запуске проекта с данными из .env файла.

2) Реализован crud для моделей:
    - автомобилей (car);
    - изображений (id которых указывается при создании автомобиля);
    - тарифов на аренду (price);
    - новостей (news);
    - контактов (contact);
    - заявок на бронирование автомобиля (booking);
    - пользователей (user).

3) При создании заявки по выбранному количеству полных суток аренды, которые вычисляются от начальной и конечной даты, рассчитывается стоимость в завимости от выбранного автомобиля и его тарифов.

4) В файле services/services_constants.py находятся доступные дополнительные услуги и их цены. Пользователь может их выбрать, указав в заявке на аренду автомобиля. Допуслуги также ключаются в стоимость аренды.

4) Созданная завка сохраняется в базе данных и автоматически отправляется на email.

5) Ендпоинт /generate_report создает файл отчета booking_report.xls за указанный период времени, из которого видно на сколько суток был забронирован каждый автомобиль.


### Запуск проекта

1) Клонируйте репозиторий на ваш локальный компьютер:

```
git clone https://github.com/eltimccc/my_rentals.git
```

2) Перейдите в каталог проекта my_rentals/services/backend/:

```
cd my_rentals/services/backend/
```

3) Установите зависимости:

```
pip install -r requirements.txt
```

4) Создайте файл .env в директории /backend/ и определите следующие переменные окружения:

```
APP_TITLE=  # Название
DESCRIPTION=  # Описание
SECRET=  # Секретный ключ
DATABASE_URL=postgresql+asyncpg://my_rental:my_rental@db:5432/db_my_rental  # Путь до БД
POSTGRES_USER=  # Пользователь постгрес
POSTGRES_PASSWORD= # Пароль постгрес
POSTGRES_DB=  # Имя базы данных
FIRST_SUPERUSER_EMAIL=  # Емейл суперпользователя
FIRST_SUPERUSER_PASSWORD=  # Пароль суперпользователя
FULL_NAME=  # Полное имя 
PHONE_NUMBER=  # Номер телефона по умолчанию
ADDRESS=  # Адрес по умолчанию

# Настройки почты для отправки заявки
SMTP_SERVER=
SMTP_PORT=5
SMTP_USERNAME=
SMTP_PASSWORD=
EMAIL_TO=
EMAIL_FROM=
```

5) Перейдите в каталог проекта my_rentals с docker_compose.yml и выполните команду для сборки контейнера:

```
docker-compose up -d --build
```

*После этого запустится контейнер с сервисом my_retals.*

6) Зайдите запущенный контейнер backend и выполните миграции:

```
alembic upgrade head
```

Использование API будет доступно по адресу http://localhost:5050/

Документация API доступна по адресу http://localhost:5050/swagger#/


### Автор
[Денис М. (Python-разработчик)](https://github.com/Eltimccc "Денис М (Python-разработчик)")
